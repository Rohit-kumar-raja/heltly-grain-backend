import{_ as j}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BxreQjmb.js";import{A as T}from"./AppDataTable-lJrrysIy.js";import{_ as E}from"./AppFormDialog.vue_vue_type_script_setup_true_lang-D6HNuNZp.js";import{s as v}from"./index-DFWna9__.js";import{s as u}from"./index-CpzPluUE.js";import{s as L}from"./index-BQxQWC8g.js";import{s as H,a as P}from"./index-BvJlFCpL.js";import{s as $}from"./index-Dpn04mTm.js";import{C as A,y as B,c as p,a as i,w as b,u as t,e as o,n as _,o as n,g as V,f as q,b as D,t as F,i as x,k}from"./app-Cba6YiDM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Du93PmFv.js";import"./index-Dg2zIGOa.js";import"./index-f8I50KTW.js";import"./index-C2ZHBv6v.js";import"./index-CKAD1gv-.js";import"./index-BYm7Lshh.js";import"./index-9M50nzO3.js";const G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},I={class:"space-y-2 col-span-1 md:col-span-2"},z={key:0,class:"text-red-500"},J={class:"col-span-1 md:col-span-2 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl space-y-4"},M={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},W={class:"space-y-2 col-span-1 md:col-span-2"},K={class:"space-y-2"},Q={class:"space-y-2"},X={class:"col-span-1 md:col-span-2 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl space-y-4"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Z={class:"space-y-2"},ee={class:"space-y-2"},le={class:"space-y-2 col-span-1 md:col-span-2"},te={key:0},oe={class:"p-inputgroup flex-1"},ae={key:1},se={key:2},ie={class:"col-span-1 md:col-span-2 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl space-y-4"},de={class:"space-y-2"},Se=Object.assign({layout:j},{__name:"Rules",props:{conditionOptions:Object,actionOptions:Object,products:Array},setup(m){const w=m,y=A(),d=x(!1),r=x(!1),c=x(null),e=B({id:null,name:"",condition_field:"",operator:"=",condition_value:"",action_type:"",action_value:"",priority:0,product_id:null}),h=[{label:"Equals (=)",value:"="},{label:"Greater Than (>)",value:">"},{label:"Less Than (<)",value:"<"},{label:"Contains",value:"contains"},{label:"Less Than or Equal (<=)",value:"<="},{label:"Greater Than or Equal (>=)",value:">="}],S=[{label:"Low",value:0},{label:"Mid",value:10},{label:"High",value:20},{label:"Very High",value:30}],U=()=>{e.reset(),e.priority=0,d.value=!0,r.value=!1},O=s=>{e.id=s.id,e.name=s.name,e.condition_field=s.condition_field,e.operator=s.operator,e.condition_value=s.condition_value,e.action_type=s.action_type,e.action_value=typeof s.action_value=="object"?JSON.stringify(s.action_value):s.action_value,e.priority=s.priority,e.product_id=s.product_id,d.value=!0},C=()=>{if(r.value=!0,!e.name||!e.condition_field||!e.action_type)return;e.id?e.put(route("meal-plan.rules.update",e.id),{onSuccess:()=>{d.value=!1,y.add({severity:"success",summary:"Successful",detail:"Rule Updated",life:3e3}),c.value.refresh()}}):e.post(route("meal-plan.rules.store"),{onSuccess:()=>{d.value=!1,y.add({severity:"success",summary:"Successful",detail:"Rule Created",life:3e3}),c.value.refresh()}})},R=k(()=>e.condition_field?e.condition_field.includes("bp_")?"e.g. 140":e.condition_field.includes("sugar")?"e.g. 100":e.condition_field==="bmi"?"e.g. 25.0":e.condition_field.includes("goal")?"e.g. lose_weight":"Enter value":"Value to match"),g=k(()=>e.action_type==="calorie_adjustment"?"Enter calories to add (positive) or remove (negative). E.g. -500":e.action_type==="tip"?"Enter the health tip to display to the user.":e.action_type==="macro_distribution"?'JSON format: {"p": 40, "c": 30, "f": 30}':""),N=[{field:"name",header:"Rule Name",sortable:!0},{field:"condition_field",header:"Condition Field",sortable:!0},{field:"operator",header:"Op"},{field:"condition_value",header:"Cond. Value"},{field:"action_type",header:"Action Type",sortable:!0},{field:"priority",header:"Priority",sortable:!0,format:s=>s>=30?"Very High":s>=20?"High":s>=10?"Mid":"Low"}];return(s,l)=>(n(),p("div",null,[i(T,{ref_key:"dataTable",ref:c,title:"Smart Rules",apiUrl:s.route("meal-plan.rules.data"),columns:N,onEdit:O},{"header-actions":b(()=>[i(t($),{label:"New Rule",icon:"pi pi-plus",class:"w-full sm:w-auto rounded-xl!",onClick:U})]),_:1},8,["apiUrl"]),i(E,{visible:d.value,"onUpdate:visible":l[10]||(l[10]=a=>d.value=a),title:t(e).id?"Edit Rule":"New Rule",onSubmit:C,onCancel:l[11]||(l[11]=a=>d.value=!1)},{default:b(()=>[o("div",G,[o("div",I,[l[12]||(l[12]=o("label",{class:"block text-sm font-semibold text-slate-700 dark:text-slate-300"},"Rule Name",-1)),i(t(v),{modelValue:t(e).name,"onUpdate:modelValue":l[0]||(l[0]=a=>t(e).name=a),class:_(["w-full! rounded-xl!",{"p-invalid":r.value&&!t(e).name}]),placeholder:"e.g. High BP Sodium Warning",autofocus:""},null,8,["modelValue","class"]),r.value&&!t(e).name?(n(),p("small",z,"Name is required.")):V("",!0),l[13]||(l[13]=o("small",{class:"block text-slate-400"},"Give this rule a descriptive name for internal use.",-1))]),o("div",J,[l[17]||(l[17]=o("div",{class:"flex items-center gap-2 mb-2"},[o("div",{class:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-600 dark:text-primary-400 font-bold"}," 1"),o("h3",{class:"font-bold text-slate-800 dark:text-slate-200"},"Condition")],-1)),o("div",M,[o("div",W,[l[14]||(l[14]=o("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-400"},"If User's...",-1)),i(t(u),{modelValue:t(e).condition_field,"onUpdate:modelValue":l[1]||(l[1]=a=>t(e).condition_field=a),options:Object.entries(m.conditionOptions).map(([a,f])=>({label:f,value:a})),optionLabel:"label",optionValue:"value",placeholder:"Select Health Parameter",class:_(["w-full! rounded-xl!",{"p-invalid":r.value&&!t(e).condition_field}]),filter:"",showClear:""},null,8,["modelValue","options","class"])]),o("div",K,[l[15]||(l[15]=o("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-400"},"Operator",-1)),i(t(u),{modelValue:t(e).operator,"onUpdate:modelValue":l[2]||(l[2]=a=>t(e).operator=a),options:h,optionLabel:"label",optionValue:"value",class:"w-full! rounded-xl!",filter:""},null,8,["modelValue"])]),o("div",Q,[l[16]||(l[16]=o("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-400"},"Value",-1)),i(t(v),{modelValue:t(e).condition_value,"onUpdate:modelValue":l[3]||(l[3]=a=>t(e).condition_value=a),class:"w-full! rounded-xl!",placeholder:R.value},null,8,["modelValue","placeholder"])])])]),o("div",X,[l[22]||(l[22]=o("div",{class:"flex items-center gap-2 mb-2"},[o("div",{class:"w-8 h-8 rounded-full bg-emerald-100 dark:bg-emerald-900 flex items-center justify-center text-emerald-600 dark:text-emerald-400 font-bold"}," 2"),o("h3",{class:"font-bold text-slate-800 dark:text-slate-200"},"Action & Result")],-1)),o("div",Y,[o("div",Z,[l[18]||(l[18]=o("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-400"},"Do this...",-1)),i(t(u),{modelValue:t(e).action_type,"onUpdate:modelValue":l[4]||(l[4]=a=>t(e).action_type=a),options:Object.entries(m.actionOptions).map(([a,f])=>({label:f,value:a})),optionLabel:"label",optionValue:"value",placeholder:"Select Action Type",class:"w-full! rounded-xl!",filter:""},null,8,["modelValue","options"])]),o("div",ee,[l[19]||(l[19]=o("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-400"},"Priority (Higher runs later)",-1)),i(t(u),{modelValue:t(e).priority,"onUpdate:modelValue":l[5]||(l[5]=a=>t(e).priority=a),options:S,optionLabel:"label",optionValue:"value",class:"w-full! rounded-xl!",placeholder:"Select Priority"},null,8,["modelValue"])]),o("div",le,[l[21]||(l[21]=o("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-400"},"Action Value",-1)),t(e).action_type==="calorie_adjustment"?(n(),p("div",te,[o("div",oe,[l[20]||(l[20]=o("span",{class:"p-inputgroup-addon bg-slate-100 dark:bg-slate-700"},"Cal",-1)),i(t(L),{modelValue:t(e).action_value,"onUpdate:modelValue":l[6]||(l[6]=a=>t(e).action_value=a),placeholder:"-500",class:"w-full! rounded-xl!"},null,8,["modelValue"])])])):t(e).action_type==="macro_distribution"?(n(),p("div",ae,[i(t(H),{modelValue:t(e).action_value,"onUpdate:modelValue":l[7]||(l[7]=a=>t(e).action_value=a),rows:"3",class:"w-full! rounded-xl!",placeholder:'{"p": 40, "c": 30, "f": 30}'},null,8,["modelValue"])])):(n(),p("div",se,[i(t(v),{modelValue:t(e).action_value,"onUpdate:modelValue":l[8]||(l[8]=a=>t(e).action_value=a),class:"w-full! rounded-xl!",placeholder:"e.g. 'Limit Sodium Intake'"},null,8,["modelValue"])])),g.value?(n(),q(t(P),{key:3,severity:"info",size:"small",variant:"simple",class:"mt-1"},{default:b(()=>[D(F(g.value),1)]),_:1})):V("",!0)])])]),o("div",ie,[l[25]||(l[25]=o("div",{class:"flex items-center gap-2 mb-2"},[o("div",{class:"w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900 flex items-center justify-center text-purple-600 dark:text-purple-400 font-bold"}," 3"),o("h3",{class:"font-bold text-slate-800 dark:text-slate-200"},"Upsell (Optional)")],-1)),o("div",de,[l[23]||(l[23]=o("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-400"},"Recommend Product",-1)),i(t(u),{modelValue:t(e).product_id,"onUpdate:modelValue":l[9]||(l[9]=a=>t(e).product_id=a),options:w.products,optionLabel:"name",optionValue:"id",filter:"",placeholder:"Search & Select Product...",class:"w-full! rounded-xl!",showClear:""},null,8,["modelValue","options"]),l[24]||(l[24]=o("small",{class:"text-slate-400"},"If this rule triggers, this product will be recommended to the user.",-1))])])])]),_:1},8,["visible","title"])]))}});export{Se as default};
